<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zod to JSON Schema Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        'code-bg': '#1e293b',
                        'code-border': '#334155'
                    }
                }
            },
            darkMode: 'class'
        };
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 min-h-screen transition-colors duration-200">
    <!-- Header -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="bg-blue-600 rounded-lg p-2">
                        <i class="fas fa-code text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Zod Schema Converter</h1>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Convert between Zod code and JSON Schema</p>
                    </div>
                </div>
                
                <!-- Theme Toggle -->
                <button id="themeToggle" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors duration-200">
                    <i class="fas fa-sun dark:hidden text-lg"></i>
                    <i class="fas fa-moon hidden dark:inline text-lg"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Input Mode Selector -->
        <div class="mb-8">
            <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-medium text-slate-900 dark:text-slate-100">Input Mode</h2>
                    <div class="text-sm text-slate-500 dark:text-slate-400">
                        Choose your input format
                    </div>
                </div>
                
                <!-- Toggle Switch -->
                <div class="flex items-center space-x-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="inputMode" value="zod" checked class="sr-only" id="zodMode">
                        <div class="relative">
                            <div class="w-12 h-6 bg-slate-200 dark:bg-slate-600 rounded-full shadow-inner transition-colors duration-200"></div>
                            <div class="absolute left-1 top-1 w-4 h-4 bg-blue-600 rounded-full transition-transform duration-200 transform" id="toggleDot"></div>
                        </div>
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Zod Code</span>
                    </label>
                    
                    <div class="text-slate-400 dark:text-slate-500">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="inputMode" value="json" class="sr-only" id="jsonMode">
                        <span class="text-sm font-medium text-slate-700 dark:text-slate-300">JSON Input</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Area -->
            <div class="space-y-6">
                <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden">
                    <div class="bg-slate-50 dark:bg-slate-700 px-6 py-4 border-b border-slate-200 dark:border-slate-600">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100" id="inputTitle">Zod Code Input</h3>
                            <div class="flex items-center space-x-2 text-sm text-slate-500 dark:text-slate-400">
                                <i class="fas fa-code"></i>
                                <span id="inputLanguage">JavaScript</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <textarea 
                            id="codeInput" 
                            class="w-full h-80 p-6 bg-code-bg text-slate-300 font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset transition-colors duration-200"
                            placeholder="Enter your Zod schema code here..."
                        ></textarea>
                    </div>
                </div>

                <!-- Convert Button -->
                <button 
                    id="convertBtn" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-4 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center space-x-3 shadow-lg hover:shadow-xl"
                >
                    <i class="fas fa-sync-alt"></i>
                    <span>Convert to JSON Schema</span>
                </button>

                <!-- Loading State -->
                <button 
                    id="convertBtnLoading" 
                    class="w-full bg-blue-500 text-white font-medium py-4 px-6 rounded-xl flex items-center justify-center space-x-3 shadow-lg hidden"
                    disabled
                >
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Converting...</span>
                </button>
            </div>

            <!-- Output Area -->
            <div class="space-y-6">
                <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden">
                    <div class="bg-slate-50 dark:bg-slate-700 px-6 py-4 border-b border-slate-200 dark:border-slate-600">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100">JSON Schema Output</h3>
                            <div class="flex items-center space-x-3">
                                <button 
                                    id="copyBtn" 
                                    class="px-3 py-1.5 text-sm bg-slate-100 dark:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-500 transition-colors duration-200 flex items-center space-x-2"
                                >
                                    <i class="fas fa-copy"></i>
                                    <span>Copy</span>
                                </button>
                                <div class="text-sm text-slate-500 dark:text-slate-400 flex items-center space-x-1">
                                    <i class="fas fa-file-code"></i>
                                    <span>JSON</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <pre 
                            id="jsonOutput" 
                            class="w-full h-80 p-6 bg-code-bg text-slate-300 font-mono text-sm overflow-auto"
                        >// Converted JSON Schema will appear here...</pre>
                    </div>
                </div>

                <!-- Error Display -->
                <div id="errorDisplay" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-sm font-medium text-red-800 dark:text-red-300 mb-1">Conversion Error</h4>
                            <p id="errorMessage" class="text-sm text-red-700 dark:text-red-400"></p>
                        </div>
                        <button id="dismissError" class="flex-shrink-0 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Success Display -->
                <div id="successDisplay" class="hidden bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl p-4">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-emerald-600 dark:text-emerald-400 text-lg"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm text-emerald-700 dark:text-emerald-300">
                                Schema converted successfully!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documentation -->
        <div class="mt-12 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm p-6">
            <h3 class="text-lg font-medium text-slate-900 dark:text-slate-100 mb-4">How to Use</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <div>
                    <h4 class="font-medium text-slate-900 dark:text-slate-100 mb-2">Zod Code Input</h4>
                    <p class="text-slate-600 dark:text-slate-400 mb-3">
                        Enter your Zod schema definition using the standard Zod syntax. The converter supports:
                    </p>
                    <ul class="text-slate-600 dark:text-slate-400 space-y-1 text-xs">
                        <li>• Object schemas with nested properties</li>
                        <li>• String, number, boolean, and array types</li>
                        <li>• Validation rules and error messages</li>
                        <li>• Optional and required fields</li>
                        <li>• Enum values and default values</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium text-slate-900 dark:text-slate-100 mb-2">JSON Schema Output</h4>
                    <p class="text-slate-600 dark:text-slate-400 mb-3">
                        The generated JSON Schema follows the latest specification and includes:
                    </p>
                    <ul class="text-slate-600 dark:text-slate-400 space-y-1 text-xs">
                        <li>• Type definitions and property constraints</li>
                        <li>• Validation rules and custom error messages</li>
                        <li>• Required field specifications</li>
                        <li>• Format validations (email, URL, etc.)</li>
                        <li>• Default values and enum constraints</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <script>
        (function() {
            // Theme management
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            
            // Initialize theme from localStorage or default to light
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                html.classList.add('dark');
            }

            themeToggle.addEventListener('click', () => {
                html.classList.toggle('dark');
                const isDark = html.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });

            // Input mode management
            const zodMode = document.getElementById('zodMode');
            const jsonMode = document.getElementById('jsonMode');
            const toggleDot = document.getElementById('toggleDot');
            const inputTitle = document.getElementById('inputTitle');
            const inputLanguage = document.getElementById('inputLanguage');
            const codeInput = document.getElementById('codeInput');
            const convertBtn = document.getElementById('convertBtn');

            function updateInputMode(mode) {
                if (mode === 'zod') {
                    toggleDot.style.transform = 'translateX(0)';
                    inputTitle.textContent = 'Zod Code Input';
                    inputLanguage.textContent = 'JavaScript';
                    codeInput.placeholder = 'Enter your Zod schema code here...';
                    convertBtn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Convert to JSON Schema</span>';
                } else {
                    toggleDot.style.transform = 'translateX(24px)';
                    inputTitle.textContent = 'JSON Input';
                    inputLanguage.textContent = 'JSON';
                    codeInput.placeholder = 'Enter your JSON data here...';
                    convertBtn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Generate Zod Schema</span>';
                }
            }

            zodMode.addEventListener('change', () => {
                if (zodMode.checked) updateInputMode('zod');
            });

            jsonMode.addEventListener('change', () => {
                if (jsonMode.checked) updateInputMode('json');
            });

            // Convert button functionality
            const convertBtnLoading = document.getElementById('convertBtnLoading');
            const errorDisplay = document.getElementById('errorDisplay');
            const successDisplay = document.getElementById('successDisplay');
            const errorMessage = document.getElementById('errorMessage');
            const jsonOutput = document.getElementById('jsonOutput');

            convertBtn.addEventListener('click', async () => {
                // Hide previous messages
                errorDisplay.classList.add('hidden');
                successDisplay.classList.add('hidden');

                // Show loading state
                convertBtn.classList.add('hidden');
                convertBtnLoading.classList.remove('hidden');

                try {
                    const inputCode = codeInput.value.trim();
                    if (!inputCode) {
                        throw new Error('Please enter some code to convert');
                    }

                    const mode = zodMode.checked ? 'zod' : 'json';
                    
                    const response = await fetch('/api/convert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            code: inputCode,
                            mode: mode
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Conversion failed');
                    }

                    const result = await response.json();
                    
                    // Show success message
                    successDisplay.classList.remove('hidden');
                    
                    // Display the result
                    if (mode === 'zod') {
                        jsonOutput.textContent = JSON.stringify(result.schema, null, 2);
                    } else {
                        jsonOutput.textContent = result.zodCode;
                    }

                } catch (error) {
                    errorMessage.textContent = error.message;
                    errorDisplay.classList.remove('hidden');
                } finally {
                    // Hide loading state
                    convertBtnLoading.classList.add('hidden');
                    convertBtn.classList.remove('hidden');
                }
            });

            // Copy functionality
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(jsonOutput.textContent);
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
                    copyBtn.classList.add('bg-emerald-100', 'dark:bg-emerald-600', 'text-emerald-700', 'dark:text-emerald-100');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.classList.remove('bg-emerald-100', 'dark:bg-emerald-600', 'text-emerald-700', 'dark:text-emerald-100');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            });

            // Error dismissal
            const dismissError = document.getElementById('dismissError');
            dismissError.addEventListener('click', () => {
                errorDisplay.classList.add('hidden');
            });

            // Initialize UI state
            updateInputMode('zod');
        })();
    </script>
</body>
</html>
